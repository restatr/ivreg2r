% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/vcov-hac.R
\name{.compute_cluster_kernel_vcov}
\alias{.compute_cluster_kernel_vcov}
\title{Compute cluster+kernel VCV (Driscoll-Kraay or Thompson)}
\usage{
.compute_cluster_kernel_vcov(
  bread,
  X_hat,
  resid,
  cluster_vec,
  time_index,
  kernel,
  bw,
  N,
  K,
  M,
  small,
  dofminus = 0L,
  sdofminus = 0L,
  weights = NULL,
  weight_type = "aweight",
  is_twoway = FALSE
)
}
\arguments{
\item{bread}{K x K bread matrix.}

\item{X_hat}{N x K projected regressor matrix (sorted by time).}

\item{resid}{N-vector of residuals (sorted by time).}

\item{cluster_vec}{Cluster vector (DK: tvar vector; Thompson: list of 2).}

\item{time_index}{List from \code{.build_time_index()}.}

\item{kernel}{Canonical kernel name.}

\item{bw}{Numeric bandwidth.}

\item{N}{Integer: number of observations.}

\item{K}{Integer: number of regressors.}

\item{M}{Integer: effective cluster count (min(M1, M2) for Thompson).}

\item{small}{Logical: apply small-sample correction.}

\item{dofminus}{Integer: large-sample DoF adjustment.}

\item{sdofminus}{Integer: small-sample DoF adjustment.}

\item{weights}{Normalized weights (sorted) or NULL.}

\item{weight_type}{Character: weight type.}

\item{is_twoway}{Logical: TRUE for Thompson, FALSE for DK.}
}
\value{
K x K variance-covariance matrix.
}
\description{
Sandwich estimator with three internal paths:
\itemize{
\item DK (one-way cluster+kernel on tvar): meat = cluster_kernel_meat
\item Thompson (two-way): meat = cluster_meat(ivar) + cluster_kernel_meat(tvar) - hc_meat
Small-sample correction: \code{(N-1)/(N-K-sdofminus) * M/(M-1)} when \code{small=TRUE}.
}
}
\keyword{internal}
