% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/diagnostics-firststage.R
\name{.compute_first_stage}
\alias{.compute_first_stage}
\title{First-stage regression diagnostics}
\usage{
.compute_first_stage(
  X,
  Z,
  weights,
  cluster_vec,
  vcov_type,
  endo_names,
  excluded_names,
  N,
  K,
  L,
  K1,
  L1,
  M,
  bread_2sls
)
}
\arguments{
\item{X}{N x K regressor matrix.}

\item{Z}{N x L instrument matrix.}

\item{weights}{Normalized weights (sum to N), or NULL.}

\item{cluster_vec}{Cluster membership vector, or NULL.}

\item{vcov_type}{Character: \code{"iid"}, \code{"HC0"}, \code{"HC1"}, or \code{"CL"}.}

\item{endo_names}{Character vector of endogenous variable names.}

\item{excluded_names}{Character vector of excluded instrument names.}

\item{N, K, L, K1, L1}{Integer dimensions.}

\item{M}{Number of clusters (or NULL).}

\item{bread_2sls}{K x K bread from 2SLS: \eqn{(X_{hat}'WX_{hat})^{-1}}.}
}
\value{
Named list keyed by endogenous variable names, each element
containing: \code{f_stat}, \code{f_p}, \code{f_df1}, \code{f_df2}, \code{partial_r2},
\code{shea_partial_r2}, \code{rmse}, \code{coefficients}, \code{residuals}, \code{fitted.values},
plus SW/AP diagnostics: \code{sw_f}, \code{sw_f_p}, \code{sw_f_df1}, \code{sw_f_df2},
\code{sw_chi2}, \code{sw_chi2_p}, \code{sw_partial_r2}, \code{ap_f}, \code{ap_f_p}, \code{ap_f_df1},
\code{ap_f_df2}, \code{ap_chi2}, \code{ap_chi2_p}, \code{ap_partial_r2}.
}
\description{
For each endogenous variable, fits the first-stage OLS regression on the
full instrument set Z, then computes: F-test of excluded instruments,
partial R², Shea partial R², and RMSE.
}
\details{
First-stage F-statistics always use small-sample degrees of freedom
(F(L1, N-L) or F(L1, M-1) for clustered models), regardless of the main
model's \code{small} option. This matches Stata's \code{ivreg2} behavior.
}
\keyword{internal}
