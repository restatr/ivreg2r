% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ivreg2.R
\name{ivreg2}
\alias{ivreg2}
\title{Extended Instrumental Variables Estimation}
\usage{
ivreg2(
  formula,
  data,
  weights,
  subset,
  na.action = stats::na.omit,
  vcov = "iid",
  clusters = NULL,
  endog = NULL,
  orthog = NULL,
  small = FALSE,
  dofminus = 0L,
  sdofminus = 0L,
  model = TRUE,
  x = FALSE,
  y = TRUE
)
}
\arguments{
\item{formula}{A formula: \code{y ~ exog} (OLS) or
\code{y ~ exog | endo | instruments} (IV).}

\item{data}{A data frame containing the variables in the formula.}

\item{weights}{Optional analytic weights expression (evaluated in \code{data}),
equivalent to Stata's \verb{[aw=varname]}. Must be strictly positive.
Weights are normalized internally to sum to N, following Stata's
convention. This makes sigma (RMSE) scale-invariant: multiplying all
weights by a constant does not change sigma. Coefficients, standard
errors, and all test statistics are unaffected by scale.

\strong{Note:} sigma will differ from \code{\link[=lm]{lm()}}\verb{(..., weights = w)} by a factor
of \code{sqrt(N / sum(w))} because \code{lm()} uses raw (unnormalized) weights.
Coefficients, SEs, and the VCV matrix are identical to \code{lm()} for OLS.}

\item{subset}{Optional subset expression (evaluated in \code{data}).}

\item{na.action}{Function for handling \code{NA}s (default \link{na.omit}).}

\item{vcov}{Character: covariance type. One of \code{"iid"} (classical),
\code{"HC0"} (White robust, no finite-sample correction), or \code{"HC1"}
(White robust with N/(N-K) finite-sample correction). To match
Stata's \verb{ivreg2, robust}: use \code{"HC0"}. To match
Stata's \verb{ivreg2, robust small}: use \code{"HC1"} with \code{small = TRUE}.}

\item{clusters}{One-sided formula specifying one or two cluster variables
(e.g. \code{~ firmid} for one-way, \code{~ firmid + year} for two-way).
Two-way clustering uses the Cameron-Gelbach-Miller (2006) formula.
The effective cluster count is \code{min(M1, M2)} per Stata convention.
The \code{small} argument controls whether the finite-sample correction
\code{(N-1)/(N-K) * M/(M-1)} is applied (matching Stata's
\verb{cluster() small} combination).}

\item{endog}{Character vector of endogenous regressor names to test for
exogeneity (endogeneity test / C-statistic). If \code{NULL} (default), tests
all endogenous regressors. Names must match variables in the endogenous
part of the formula. Ignored for OLS models.}

\item{orthog}{Character vector of instrument names to test for
orthogonality (instrument-subset C-statistic). Names must be included
or excluded instruments (not endogenous regressors or the intercept).
If \code{NULL} (default), no orthogonality test is computed. Ignored for
OLS models. Equivalent to Stata's \code{orthog()} option.}

\item{small}{Logical: if \code{TRUE}, use small-sample corrections
(t/F instead of z/chi-squared, \code{N-K} denominator for sigma).}

\item{dofminus}{Non-negative integer: large-sample degrees-of-freedom
adjustment. Subtracted from N in large-sample variance formulas
(e.g., sigma = rss/(N-dofminus)). Useful when fixed effects have been
partialled out. Equivalent to Stata's \code{dofminus()} option.}

\item{sdofminus}{Non-negative integer: small-sample degrees-of-freedom
adjustment. Subtracted from the residual degrees of freedom alongside K
(e.g., df.residual = N - K - dofminus - sdofminus). Useful when
partialling out regressors. Equivalent to Stata's \code{sdofminus()} option.}

\item{model}{Logical: if \code{TRUE} (default), store the model frame in the
return object.}

\item{x}{Logical: if \code{TRUE}, store model matrices (\code{X}, \code{Z}) in the
return object.}

\item{y}{Logical: if \code{TRUE} (default), store the response vector in the
return object.}
}
\value{
An object of class \code{"ivreg2"}.
}
\description{
Estimate models by OLS or two-stage least squares (2SLS) with automatic
diagnostic tests. Uses a three-part formula for IV:
\code{y ~ exog | endo | instruments}.
}
\examples{
fit <- ivreg2(mpg ~ wt + hp, data = mtcars)
print(fit)
coef(fit)

}
