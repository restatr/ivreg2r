% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/diagnostics-overid.R
\name{.compute_omega}
\alias{.compute_omega}
\title{Compute L x L moment covariance matrix Omega}
\usage{
.compute_omega(
  Z,
  residuals,
  weights,
  cluster_vec,
  N,
  dofminus = 0L,
  weight_type = "aweight",
  kernel = NULL,
  bw = NULL,
  time_index = NULL
)
}
\arguments{
\item{Z}{N x L instrument matrix.}

\item{residuals}{N x 1 residual vector.}

\item{weights}{Normalized weights (sum to N), or NULL.}

\item{cluster_vec}{Cluster membership vector, or NULL.}

\item{N}{Number of observations.}

\item{dofminus}{Integer: large-sample DoF adjustment (default 0).
HC path divides by \code{N - dofminus} (Stata livreg2.do line 326);
cluster path divides by \code{N} (line 545, no dofminus adjustment).}

\item{kernel}{Canonical kernel name, or NULL for non-HAC.}

\item{bw}{Numeric bandwidth, or NULL.}

\item{time_index}{List from \code{.build_time_index()}, or NULL.}
}
\value{
L x L symmetric matrix Omega.
}
\description{
Computes the instrument-space score covariance for the Hansen J test.
This is a \emph{new} computation in Z-space, not the K x K meat from vcov-robust.R.
}
\keyword{internal}
